<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/swiper.min.css">
    <link rel="stylesheet" href="css/chat.css">
    <script src="js/common.js"></script>
    <script src="js/bscroll.min.js"></script>
    <script src="js/jquery-1.11.2.min.js"></script>
    <script src="js/swiper.min.js"></script>
    <title>智能回复</title>
</head>

<body>
    <div id="chat-box">
        <div class="chat-wrap">
            <div class="pull-down-wrap">下拉刷新</div>
            <div class="chat-con">
                <div class="chat-opposite">
                    <div class="opposite-chat-modal-1 opposite-chat-modal">
                        啊实打实解答考生的阿斯达克阿瑟东
                    </div>
                </div>
                <div class="chat-opposite">
                    <div class="opposite-chat-modal-2 opposite-chat-modal">
                        啊实打实解答考生的阿斯<img src="imgs/chat1.png" alt="">达克阿瑟东啊实打实解答考生的阿斯达克阿瑟东<img src="imgs/chat1.png" alt="">
                    </div>
                </div>
                <div class="chat-self">
                    <div class="self-chat-modal">
                        hello world !
                    </div>
                </div>
                <div class="chat-opposite">
                    <div class="opposite-chat-modal-3 opposite-chat-modal">
                        <div class="modal-3-title">猜你想问</div>
                        <div class="modal-requset">
                            <span>最近有啥新车上市？</span>
                            <img src="imgs/request.png" alt="">
                        </div>
                        <div class="modal-requset">
                            <span>怎样找到适合自己的那款车？</span>
                            <img src="imgs/request.png" alt="">
                        </div>
                        <div class="modal-requset">
                            <span>汽车保养有啥小妙招？</span>
                            <img src="imgs/request.png" alt="">
                        </div>
                        <div class="modal-requset">
                            <span>最近购车有啥优惠活动？</span>
                            <img src="imgs/request.png" alt="">
                        </div>
                    </div>
                </div>
                <div class="chat-opposite">
                    <div class="opposite-chat-modal-4 opposite-chat-modal">
                        <div class="modal-4-greeting">
                            嗨！您好，<img src="imgs/chat2.png" alt=""><br/> 北汽携手朗读者 关于故乡我们一起朗读
                            <img src="imgs/chat1.png" alt="">
                        </div>
                        <div class="modal-4-descript">
                            订阅号评论下方留下你想对故乡说的话吧</p>
                            <p>获赞前五名的朋友</p>
                            <p>可获得50元话费充值卡一张</p>
                            <p>想家的时候，就和家里通个电话吧 </p>
                        </div>
                        <div class="modal-4-enter-website" data-url="http://www.baidu.com">进入官网查看详情</div>
                        <div class="modal-card" data-imgs="imgs/chat3.png">
                            <img src="imgs/chat3.png" alt="">
                        </div>
                        <div class="modal-requset">
                            <span>谁都可以参与吗？</span>
                            <img src="imgs/request.png" alt="">
                        </div>
                        <div class="modal-requset">
                            <span>活动什么时候开始呢？</span>
                            <img src="imgs/request.png" alt="">
                        </div>
                        <div class="modal-requset">
                            <span>还有其他这样的福利吗？</span>
                            <img src="imgs/request.png" alt="">
                        </div>
                    </div>
                </div>
                <div class="chat-opposite">
                    <div class="opposite-chat-modal-5 opposite-chat-modal">
                        <div class="modal-5-greeting">昌河 A6 震撼上市！
                            <img src="imgs/chat1.png" alt="">
                        </div>
                        <div class="modal-card" data-imgs="imgs/chat4.png,imgs/chat4.png,imgs/chat4.png">
                            <img src="imgs/chat4.png" alt="">
                        </div>
                        <div class="modal-requset">
                            <span>现在买有什么优惠？</span>
                            <img src="imgs/request.png" alt="">
                        </div>
                        <div class="modal-requset">
                            <span>昌河A6详细价格及配置？</span>
                            <img src="imgs/request.png" alt="">
                        </div>
                        <div class="modal-requset">
                            <span>汽车保养有啥小妙招？</span>
                            <img src="imgs/request.png" alt="">
                        </div>
                        <div class="modal-requset">
                            <span>A6车主绑定服务号？</span>
                            <img src="imgs/request.png" alt="">
                        </div>
                    </div>
                </div>
                <div class="chat-self">
                    <div class="self-chat-modal">
                        汽车保养小知识
                    </div>
                </div>
                <div class="chat-opposite">
                    <div class="opposite-chat-modal-6 opposite-chat-modal">
                        <div class="modal-6-title">1、汽车发动机舱应该怎么清洗？</div>
                        <div class="modal-6-response">清洗发动机舱是不可以随便用水洗的，请到修理厂清洗，因为发动机有各种感应器，高压包等电器，所以清洗时要注意，洗完后要用气 枪吹干。</div>
                        <div class="modal-6-title">2、汽车的前轮刹车片磨损不均匀是怎么回事？</div>
                        <div class="modal-6-response">这个故障现象说明左前轮制动回位不良，重点检查一下制动分泵和制动卡钳这些部件，如果检查存在故障，最好是及时更换，以免影响行车安全。</div>
                        <div class="modal-6-title">3、如何防止车轮上螺栓螺母生锈？</div>
                        <div class="modal-6-response">正常情况下不会生锈的，轮胎螺丝一般都是不锈钢的，如果锈蚀了最好选择更换，千万不能打润滑油。</div>
                        <div class="modal-6-title">4、如何检查和减少轮胎磨损？</div>
                        <div class="modal-6-response">定期检查轮胎的磨损程度，定期调换轮胎，必要时做四轮定位。</div>
                        <div class="modal-6-title">5、车子跑了四万公里要做哪些保养？</div>
                        <div class="modal-6-response">按保养手册规定更换机油、机滤、空滤、空调滤、刹车油、防冻液，检查自动变速箱油。</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="option integral-shadow">
        <input type="text" placeholder="有问题 找昌哥">
        <img src="imgs/send_no.png" alt="" class="send" data-img="imgs/send.png">
        <!-- <img src="imgs/send_no.png" alt=""> -->
    </div>
    <div class="chat-modal-box">
        <div class="chat-modal">
            <div class="chat-modal-title"></div>
            <div class="chat-modal-option">
                <div class="chat-modal-confirm">是</div>
                <div class="chat-modal-cancel">取消</div>
            </div>
        </div>
    </div>
    <div class="chat-swiper-modal">
        <div class="chat-swiper-box">
            <div class="chat-swiper">
                <div class="swiper-wrapper"></div>
            </div>
            <img src="imgs/swiper_left.png" alt="" class="change-swiper-left">
            <img src="imgs/swiper_right.png" alt="" class="change-swiper-right">
        </div>
    </div>
</body>

</html>
<script>
    $(function () {
        // 点击发送消息
        var scroll = null;
        setTimeout(function () {
            var scrollBox = document.getElementById('chat-box');
            scroll = new BScroll(scrollBox, {
                click: true,
                // bounce:false,
                probeType: 0,
                pullDownRefresh: {
                    threshold: 50,
                    stop: 50
                }
            });
            //下拉加载
            scroll.on('pullingDown', function () {
                // alert(111)
                // scroll.finishPullDown();
                $('.pull-down-wrap').text('加载中 · · ·');
                setTimeout(function () {
                    $('.pull-down-wrap').text('加载成功');
                    setTimeout(function () {
                        $('.pull-down-wrap').text('下拉刷新');
                        scroll.finishPullDown();
                    }, 1000);
                }, 2000);
            })
        }, 200)



        // 输入框输入内容
        var inputText = '';
        $('.option input').bind('input propertychange', function () {
            if ($(this).val().trim()) {
                $('.option .send').attr('src', 'imgs/send.png')
            } else {
                $('.option .send').attr('src', 'imgs/send_no.png')
            }
            inputText = $(this).val();
        });




        //键盘弹出
        var winHeight = $(window).height();
        $(window).resize(function () {
            var thisHeight = $(this).height();
            if (winHeight - thisHeight > 50) {
                scrollToBottom();
            }
        });

        function scrollToBottom() {
            var scrolly = $('.chat-wrap').height() - $(window).height() + $('.option').height();
            scroll.scrollTo(0, -scrolly, 100, 'linear');
        }


        // 双向通信
        var ws = new WebSocket('ws://echo.websocket.org');

        ws.onopen = function () {
            wx.showToast({
                title: '已连接',
                duration: 1000
            })
        };

        ws.onmessage = function (evt) { console.log(evt.data) };

        ws.onclose = function (evt) {
            wx.showToast({
                title: '连接已断开',
                duration: 1000
            })
        };

        ws.onerror = function (evt) {
            wx.showToast({
                title: '出错了',
                duration: 1000
            })
        };
        // 点击提交按钮
        $('.send ').click(function (e) {
            if (!inputText.trim()) {
                return;
            }
            var temp = "<div class='chat-self'><div class='self-chat-modal'>" + inputText + "</div></div>"
            $('.chat-wrap .chat-con').append(temp);
            ws.send(inputText);
            $('.option input').val('');
            $('.option .send').attr('src', 'imgs/send_no.png');
            scroll.refresh();
            inputText = '';
            scrollToBottom();
            // alert(333)
        })
        $('.option').click(function () {
            $('.option input').focus();
        })


        //点击模板提问板块
        $('.chat-con').on('click','.opposite-chat-modal .modal-requset',function(){
            var test = $(this).find('span').text();
            ws.send(test);
            var temp = "<div class='chat-self'><div class='self-chat-modal'>" + test + "</div></div>"
            $('.chat-wrap .chat-con').append(temp);
            scroll.refresh();
            scrollToBottom();
        })

        //跳转别的网站
        $('.chat-con').on('click','.opposite-chat-modal-4 .modal-4-enter-website',function(){
            var url = $(this).attr('data-url');
            wx.showModal({
                title: '将要跳转到其它页面是否继续？',
                confirm: function () {
                    // alert('点击了确定')
                    // console.log(this);
                    location.href = url;
                },
                cancel: function () {
                    // alert('点击了取消')
                }
            });
        })

        //点击模板卡片图片弹出轮播
        var chatSwiper = null;
        var nextbtn = document.querySelector('.chat-swiper-box .change-swiper-right');
        var prevbtn = document.querySelector('.chat-swiper-box .change-swiper-left');
        var chatSwiperModal = document.querySelector('.chat-swiper-modal');
        $('.chat-con').on('click','.opposite-chat-modal .modal-card',function(){
            $('.chat-swiper-modal').show(); 
            var imgs = $(this).attr('data-imgs');
            var imgarr = imgs.split(',');
            var str = "";
            imgarr.forEach(ele=>{
                str += "<div class='swiper-slide'><img src="+ele+" /></div>";
            })
            $('.chat-swiper .swiper-wrapper').append(str);
            if (imgarr.length<=1){
                $(nextbtn).hide();
                $(prevbtn).hide();
            } else {
                $(nextbtn).show();
                $(prevbtn).hide();
                chatSwiper = new Swiper('.chat-swiper',{
                    onSlideChangeStart: function(swiper){
                        $(nextbtn).show();
                        $(prevbtn).show();
                        if (imgarr.length-1==swiper.activeIndex){
                            $(nextbtn).hide();
                        } else if (swiper.activeIndex==0){
                            $(prevbtn).hide();
                        }
                    }
                });
            }
            nextbtn.onclick = function (e){
                e.stopPropagation();
                chatSwiper.slideNext()
            }
            prevbtn.onclick = function (e){
                e.stopPropagation();
                chatSwiper.slidePrev()
            }
            chatSwiperModal.onclick = function(){
                if (chatSwiper) {
                    chatSwiper.slideTo(0);
                    chatSwiper.destroy();   
                }
                chatSwiper = null;
                nextbtn.onclick = null;
                prevbtn.onclick = null;
                $('.chat-swiper .swiper-wrapper').empty();
                $(this).hide();
            }
        })
    })

</script>